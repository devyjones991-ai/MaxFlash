@echo off
chcp 65001 >nul
title MaxFlash Trading System

REM ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡Ñ‚Ð¾ Ð¼Ñ‹ Ð² Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¹ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸
if not exist "app\main.py" (
    echo [ÐžÐ¨Ð˜Ð‘ÐšÐ] Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¸Ð· ÐºÐ¾Ñ€Ð½Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° MaxFlash!
    pause
    exit /b 1
)

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘         MAXFLASH TRADING SYSTEM - Ð—ÐÐŸÐ£Ð¡Ðš                 â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

REM Ð‘Ñ‹ÑÑ‚Ñ€Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¸ Ð·Ð°Ð¿ÑƒÑÐº
if not exist "venv" (
    echo [ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ] ÐŸÐµÑ€Ð²Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº - Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÑŽ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ...
    call setup_simple.bat
    if errorlevel 1 (
        echo [ÐžÐ¨Ð˜Ð‘ÐšÐ] ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð½Ðµ ÑƒÐ´Ð°Ð»Ð°ÑÑŒ
        pause
        exit /b 1
    )
    echo.
)

call venv\Scripts\activate.bat 2>nul
if errorlevel 1 (
    echo [ÐžÐ¨Ð˜Ð‘ÐšÐ] ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð²Ð¸Ñ€Ñ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ðµ
    echo Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ setup_simple.bat ÑÐ½Ð°Ñ‡Ð°Ð»Ð°
    pause
    exit /b 1
)

REM ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Docker
docker ps >nul 2>&1
if errorlevel 1 (
    echo [ÐŸÐ Ð•Ð”Ð£ÐŸÐ Ð•Ð–Ð”Ð•ÐÐ˜Ð•] Docker Ð½Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½!
    echo Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Docker Desktop Ð¸ Ð¿Ð¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ ÑÐ½Ð¾Ð²Ð°
    pause
    exit /b 1
)

REM Ð—Ð°Ð¿ÑƒÑÐº Docker ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
echo [Ð—ÐÐŸÐ£Ð¡Ðš] Ð—Ð°Ð¿ÑƒÑÐº PostgreSQL Ð¸ Redis...
docker-compose -f infra/docker-compose.yml up -d >nul 2>&1
if errorlevel 1 (
    echo [ÐžÐ¨Ð˜Ð‘ÐšÐ] ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Docker ÑÐµÑ€Ð²Ð¸ÑÑ‹
    pause
    exit /b 1
)

echo [ÐžÐ–Ð˜Ð”ÐÐÐ˜Ð•] ÐžÐ¶Ð¸Ð´Ð°Ð½Ð¸Ðµ Ð³Ð¾Ñ‚Ð¾Ð²Ð½Ð¾ÑÑ‚Ð¸ Ð‘Ð”...
timeout /t 8 /nobreak >nul

REM ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
echo [ÐœÐ˜Ð“Ð ÐÐ¦Ð˜Ð˜] ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¹ Ð‘Ð”...
alembic upgrade head >nul 2>&1

echo.
echo â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
echo â•‘              Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ Ð—ÐÐŸÐ£Ð©Ð•ÐÐ!                            â•‘
echo â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo ðŸŒ API: http://localhost:8000
echo ðŸ“š Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ: http://localhost:8000/docs
echo â¤ï¸  Health: http://localhost:8000/health
echo.
echo â¹ï¸  Ð”Ð»Ñ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸ Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C
echo.
echo ========================================
echo.

python -m uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

REM Ð•ÑÐ»Ð¸ Ð´Ð¾ÑˆÐ»Ð¸ ÑÑŽÐ´Ð° - Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ð» ÑÐµÑ€Ð²ÐµÑ€
echo.
echo ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Docker ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²...
docker-compose -f infra/docker-compose.yml down >nul 2>&1
echo Ð“Ð¾Ñ‚Ð¾Ð²Ð¾!
